start on runlevel [2345]
stop on runlevel [06]

respawn
respawn limit 10 5

chdir /var/lib/docker-registry/

env USER=www-data
env GROUP=www-data
env LOG_FILE=/var/log/docker/registry.log
env NUM_WORKERS=9

env ADDRESS=0.0.0.0:5000

env SETTINGS_FLAVOR=<%= @settings_flavor %>


pre-start script
    [ -f /etc/default/docker-registry ] && . /etc/default/docker-registry

    dir=$(dirname $LOG_FILE)
    test -d $dir || mkdir -p $dir
end script


script
    [ -f /etc/default/docker-registry ] && . /etc/default/docker-registry
    exec gunicorn -w $NUM_WORKERS --bind=$ADDRESS --user=$USER --group=$GROUP --log-level=$LOG_LEVEL --log-file=$LOG_FILE 2>>$LOG_FILE wsgi:application
end script